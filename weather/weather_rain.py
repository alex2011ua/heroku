'''
https://openweathermap.org/
'''

import requests
import json
import datetime
timestamp = 1600430400
value = datetime.datetime.fromtimestamp(timestamp)
value = value - datetime.timedelta(hours = 2)
print(value.strftime('%Y-%m-%d %H:%M:%S'))


#rr = r.replace("'", '"')
'''
r = '{"cod":"200","message":0,"cnt":40,"list":[{"dt":1600430400,"main":{"temp":298.51,"feels_like":296.33,"temp_min":298.51,"temp_max":298.87,"pressure":1017,"sea_level":1017,"grnd_level":1011,"humidity":44,"temp_kf":-0.36},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":4.09,"deg":68},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-09-18 12:00:00"},{"dt":1600441200,"main":{"temp":300.26,"feels_like":298.1,"temp_min":300.26,"temp_max":300.84,"pressure":1015,"sea_level":1015,"grnd_level":1008,"humidity":40,"temp_kf":-0.58},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":64},"wind":{"speed":4.12,"deg":79},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-09-18 15:00:00"},{"dt":1600452000,"main":{"temp":298.65,"feels_like":296.73,"temp_min":298.65,"temp_max":298.68,"pressure":1014,"sea_level":1014,"grnd_level":1008,"humidity":49,"temp_kf":-0.03},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":72},"wind":{"speed":4.54,"deg":48},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-09-18 18:00:00"},{"dt":1600462800,"main":{"temp":296.97,"feels_like":295.26,"temp_min":296.96,"temp_max":296.97,"pressure":1015,"sea_level":1015,"grnd_level":1008,"humidity":54,"temp_kf":0.01},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":97},"wind":{"speed":4.22,"deg":77},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-09-18 21:00:00"},{"dt":1600473600,"main":{"temp":296.37,"feels_like":294.57,"temp_min":296.37,"temp_max":296.37,"pressure":1014,"sea_level":1014,"grnd_level":1008,"humidity":53,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":99},"wind":{"speed":3.95,"deg":109},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-09-19 00:00:00"},{"dt":1600484400,"main":{"temp":294.89,"feels_like":293.82,"temp_min":294.89,"temp_max":294.89,"pressure":1013,"sea_level":1013,"grnd_level":1007,"humidity":60,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":100},"wind":{"speed":3.15,"deg":156},"visibility":10000,"pop":0.75,"rain":{"3h":0.87},"sys":{"pod":"n"},"dt_txt":"2020-09-19 03:00:00"},{"dt":1600495200,"main":{"temp":294.3,"feels_like":294.39,"temp_min":294.3,"temp_max":294.3,"pressure":1013,"sea_level":1013,"grnd_level":1007,"humidity":66,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":1.94,"deg":158},"visibility":10000,"pop":0.5,"sys":{"pod":"d"},"dt_txt":"2020-09-19 06:00:00"},{"dt":1600506000,"main":{"temp":297.64,"feels_like":296.28,"temp_min":297.64,"temp_max":297.64,"pressure":1013,"sea_level":1013,"grnd_level":1007,"humidity":52,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":96},"wind":{"speed":3.74,"deg":125},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-09-19 09:00:00"},{"dt":1600516800,"main":{"temp":302.78,"feels_like":300.99,"temp_min":302.78,"temp_max":302.78,"pressure":1013,"sea_level":1013,"grnd_level":1007,"humidity":33,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":94},"wind":{"speed":3.29,"deg":130},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-09-19 12:00:00"},{"dt":1600527600,"main":{"temp":301.84,"feels_like":300.71,"temp_min":301.84,"temp_max":301.84,"pressure":1012,"sea_level":1012,"grnd_level":1006,"humidity":36,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":2.56,"deg":167},"visibility":10000,"pop":0.2,"sys":{"pod":"d"},"dt_txt":"2020-09-19 15:00:00"},{"dt":1600538400,"main":{"temp":296.38,"feels_like":296.94,"temp_min":296.38,"temp_max":296.38,"pressure":1013,"sea_level":1013,"grnd_level":1006,"humidity":61,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":100},"wind":{"speed":1.65,"deg":170},"visibility":10000,"pop":0.9,"rain":{"3h":1.28},"sys":{"pod":"n"},"dt_txt":"2020-09-19 18:00:00"},{"dt":1600549200,"main":{"temp":294.75,"feels_like":294.87,"temp_min":294.75,"temp_max":294.75,"pressure":1014,"sea_level":1014,"grnd_level":1008,"humidity":68,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":83},"wind":{"speed":2.37,"deg":153},"visibility":10000,"pop":0.51,"sys":{"pod":"n"},"dt_txt":"2020-09-19 21:00:00"},{"dt":1600560000,"main":{"temp":294.18,"feels_like":294.78,"temp_min":294.18,"temp_max":294.18,"pressure":1014,"sea_level":1014,"grnd_level":1008,"humidity":70,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":91},"wind":{"speed":1.63,"deg":70},"visibility":10000,"pop":0.55,"rain":{"3h":0.42},"sys":{"pod":"n"},"dt_txt":"2020-09-20 00:00:00"},{"dt":1600570800,"main":{"temp":293.31,"feels_like":293.92,"temp_min":293.31,"temp_max":293.31,"pressure":1014,"sea_level":1014,"grnd_level":1008,"humidity":73,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":99},"wind":{"speed":1.52,"deg":86},"visibility":10000,"pop":0.4,"rain":{"3h":0.11},"sys":{"pod":"n"},"dt_txt":"2020-09-20 03:00:00"},{"dt":1600581600,"main":{"temp":292.86,"feels_like":293.1,"temp_min":292.86,"temp_max":292.86,"pressure":1015,"sea_level":1015,"grnd_level":1009,"humidity":75,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":96},"wind":{"speed":2.04,"deg":115},"visibility":10000,"pop":0.27,"sys":{"pod":"d"},"dt_txt":"2020-09-20 06:00:00"},{"dt":1600592400,"main":{"temp":295.44,"feels_like":294.75,"temp_min":295.44,"temp_max":295.44,"pressure":1015,"sea_level":1015,"grnd_level":1009,"humidity":62,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":3.12,"deg":112},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-09-20 09:00:00"},{"dt":1600603200,"main":{"temp":297.88,"feels_like":297.32,"temp_min":297.88,"temp_max":297.88,"pressure":1015,"sea_level":1015,"grnd_level":1009,"humidity":49,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":2.27,"deg":141},"visibility":10000,"pop":0.02,"sys":{"pod":"d"},"dt_txt":"2020-09-20 12:00:00"},{"dt":1600614000,"main":{"temp":298.29,"feels_like":297.93,"temp_min":298.29,"temp_max":298.29,"pressure":1014,"sea_level":1014,"grnd_level":1008,"humidity":47,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":1.85,"deg":93},"visibility":10000,"pop":0.02,"sys":{"pod":"d"},"dt_txt":"2020-09-20 15:00:00"},{"dt":1600624800,"main":{"temp":296.78,"feels_like":296.86,"temp_min":296.78,"temp_max":296.78,"pressure":1015,"sea_level":1015,"grnd_level":1008,"humidity":51,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":1.17,"deg":36},"visibility":10000,"pop":0.06,"sys":{"pod":"n"},"dt_txt":"2020-09-20 18:00:00"},{"dt":1600635600,"main":{"temp":295.54,"feels_like":295.84,"temp_min":295.54,"temp_max":295.54,"pressure":1016,"sea_level":1016,"grnd_level":1009,"humidity":56,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":0.99,"deg":2},"visibility":10000,"pop":0.21,"sys":{"pod":"n"},"dt_txt":"2020-09-20 21:00:00"},{"dt":1600646400,"main":{"temp":293.9,"feels_like":294.52,"temp_min":293.9,"temp_max":293.9,"pressure":1015,"sea_level":1015,"grnd_level":1009,"humidity":58,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":0.08,"deg":313},"visibility":10000,"pop":0.19,"sys":{"pod":"n"},"dt_txt":"2020-09-21 00:00:00"},{"dt":1600657200,"main":{"temp":292.8,"feels_like":292.55,"temp_min":292.8,"temp_max":292.8,"pressure":1015,"sea_level":1015,"grnd_level":1009,"humidity":57,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":94},"wind":{"speed":0.78,"deg":345},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-09-21 03:00:00"},{"dt":1600668000,"main":{"temp":291.92,"feels_like":291.54,"temp_min":291.92,"temp_max":291.92,"pressure":1015,"sea_level":1015,"grnd_level":1009,"humidity":57,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":93},"wind":{"speed":0.63,"deg":48},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-09-21 06:00:00"},{"dt":1600678800,"main":{"temp":295.83,"feels_like":295.81,"temp_min":295.83,"temp_max":295.83,"pressure":1016,"sea_level":1016,"grnd_level":1009,"humidity":49,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02d"}],"clouds":{"all":16},"wind":{"speed":0.66,"deg":171},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-09-21 09:00:00"},{"dt":1600689600,"main":{"temp":299.46,"feels_like":299.07,"temp_min":299.46,"temp_max":299.46,"pressure":1015,"sea_level":1015,"grnd_level":1009,"humidity":44,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":7},"wind":{"speed":1.92,"deg":216},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-09-21 12:00:00"},{"dt":1600700400,"main":{"temp":299.88,"feels_like":299.13,"temp_min":299.88,"temp_max":299.88,"pressure":1013,"sea_level":1013,"grnd_level":1007,"humidity":42,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":37},"wind":{"speed":2.29,"deg":234},"visibility":10000,"pop":0.33,"rain":{"3h":0.19},"sys":{"pod":"d"},"dt_txt":"2020-09-21 15:00:00"},{"dt":1600711200,"main":{"temp":297.84,"feels_like":297.29,"temp_min":297.84,"temp_max":297.84,"pressure":1013,"sea_level":1013,"grnd_level":1007,"humidity":48,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":64},"wind":{"speed":2.09,"deg":234},"visibility":10000,"pop":0.29,"rain":{"3h":0.12},"sys":{"pod":"n"},"dt_txt":"2020-09-21 18:00:00"},{"dt":1600722000,"main":{"temp":295.74,"feels_like":295.54,"temp_min":295.74,"temp_max":295.74,"pressure":1013,"sea_level":1013,"grnd_level":1007,"humidity":57,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":37},"wind":{"speed":1.91,"deg":237},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-09-21 21:00:00"},{"dt":1600732800,"main":{"temp":294.22,"feels_like":294.47,"temp_min":294.22,"temp_max":294.22,"pressure":1012,"sea_level":1012,"grnd_level":1006,"humidity":62,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02n"}],"clouds":{"all":19},"wind":{"speed":1.21,"deg":248},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-09-22 00:00:00"},{"dt":1600743600,"main":{"temp":293.06,"feels_like":292.88,"temp_min":293.06,"temp_max":293.06,"pressure":1012,"sea_level":1012,"grnd_level":1005,"humidity":65,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":26},"wind":{"speed":1.65,"deg":202},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2020-09-22 03:00:00"},{"dt":1600754400,"main":{"temp":291.89,"feels_like":290.7,"temp_min":291.89,"temp_max":291.89,"pressure":1011,"sea_level":1011,"grnd_level":1005,"humidity":71,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02d"}],"clouds":{"all":13},"wind":{"speed":3.2,"deg":213},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-09-22 06:00:00"},{"dt":1600765200,"main":{"temp":293.99,"feels_like":292.22,"temp_min":293.99,"temp_max":293.99,"pressure":1011,"sea_level":1011,"grnd_level":1005,"humidity":65,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":4.34,"deg":217},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-09-22 09:00:00"},{"dt":1600776000,"main":{"temp":294.36,"feels_like":292.04,"temp_min":294.36,"temp_max":294.36,"pressure":1010,"sea_level":1010,"grnd_level":1003,"humidity":63,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":10},"wind":{"speed":5.06,"deg":234},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2020-09-22 12:00:00"},{"dt":1600786800,"main":{"temp":295.16,"feels_like":292.84,"temp_min":295.16,"temp_max":295.16,"pressure":1008,"sea_level":1008,"grnd_level":1002,"humidity":61,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":86},"wind":{"speed":5.19,"deg":237},"visibility":10000,"pop":0.36,"rain":{"3h":0.26},"sys":{"pod":"d"},"dt_txt":"2020-09-22 15:00:00"},{"dt":1600797600,"main":{"temp":294.17,"feels_like":292.92,"temp_min":294.17,"temp_max":294.17,"pressure":1008,"sea_level":1008,"grnd_level":1002,"humidity":59,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":60},"wind":{"speed":2.98,"deg":244},"visibility":10000,"pop":0.83,"rain":{"3h":0.38},"sys":{"pod":"n"},"dt_txt":"2020-09-22 18:00:00"},{"dt":1600808400,"main":{"temp":291.72,"feels_like":291.48,"temp_min":291.72,"temp_max":291.72,"pressure":1009,"sea_level":1009,"grnd_level":1002,"humidity":71,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":78},"wind":{"speed":1.77,"deg":300},"visibility":10000,"pop":0.85,"rain":{"3h":2.47},"sys":{"pod":"n"},"dt_txt":"2020-09-22 21:00:00"},{"dt":1600819200,"main":{"temp":291.33,"feels_like":290.35,"temp_min":291.33,"temp_max":291.33,"pressure":1008,"sea_level":1008,"grnd_level":1002,"humidity":72,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":89},"wind":{"speed":2.75,"deg":241},"visibility":10000,"pop":0.99,"rain":{"3h":0.26},"sys":{"pod":"n"},"dt_txt":"2020-09-23 00:00:00"},{"dt":1600830000,"main":{"temp":290.43,"feels_like":289.02,"temp_min":290.43,"temp_max":290.43,"pressure":1007,"sea_level":1007,"grnd_level":1000,"humidity":75,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":100},"wind":{"speed":3.26,"deg":272},"visibility":10000,"pop":0.87,"rain":{"3h":2.96},"sys":{"pod":"n"},"dt_txt":"2020-09-23 03:00:00"},{"dt":1600840800,"main":{"temp":288.92,"feels_like":287.53,"temp_min":288.92,"temp_max":288.92,"pressure":1007,"sea_level":1007,"grnd_level":1000,"humidity":82,"temp_kf":0},"weather":[{"id":501,"main":"Rain","description":"moderate rain","icon":"10d"}],"clouds":{"all":100},"wind":{"speed":3.18,"deg":250},"visibility":6014,"pop":0.95,"rain":{"3h":3.75},"sys":{"pod":"d"},"dt_txt":"2020-09-23 06:00:00"},{"dt":1600851600,"main":{"temp":289.04,"feels_like":287.25,"temp_min":289.04,"temp_max":289.04,"pressure":1007,"sea_level":1007,"grnd_level":1001,"humidity":77,"temp_kf":0},"weather":[{"id":501,"main":"Rain","description":"moderate rain","icon":"10d"}],"clouds":{"all":100},"wind":{"speed":3.38,"deg":241},"visibility":10000,"pop":1,"rain":{"3h":3.5},"sys":{"pod":"d"},"dt_txt":"2020-09-23 09:00:00"}],"city":{"id":2968815,"name":"Paris","coord":{"lat":48.85,"lon":2.34},"country":"FR","population":0,"timezone":7200,"sunrise":1600407116,"sunset":1600451854}}'
d = json.loads(r)
summ = 0
print()
for i in d["list"]:
    if i.get('rain'):
        print('yes')
    else:
        print('no')
    try:
        print(i['rain']['3h'])
        summ += float(i['rain']['3h'])
    except KeyError:
        pass
print(summ)
print(d['city']['name'])
timestamp = d['list'][0]['dt']
value = datetime.datetime.fromtimestamp(timestamp)
value = value - datetime.timedelta(hours = 2)
print(value.strftime('%Y-%m-%d %H:%M:%S'))
'''
def weather_rain_summ(lat=50.40, lon= 30.31):
    '''
    :param lat: lattitude(широта)
    :param lon: longtitude (долгота)
    :return: summ of rain (Сумма воды которая выпадет за 5 дней)
    '''
    payload = {'lat': lat,
               'lon': lon,
               'appid': 'd16e0dacb5474e43829b385c7102e12d'}
    url = 'https://api.openweathermap.org/data/2.5/forecast'
    r = requests.get(url, params = payload)
    d = r.json()
    summ = 0
    for i in d["list"]:
        if i.get('rain'):
            summ += float(i['rain']['3h'])
    print(d['city']['name'])
    timestamp = d['list'][0]['dt']
    value = datetime.datetime.fromtimestamp(timestamp)
    value = value - datetime.timedelta(hours = 2)
    print(value.strftime('%Y-%m-%d %H:%M:%S'))
    context = {'rain': summ, 'date': value.strftime('%Y-%m-%d %H:%M:%S')}
    return context


if __name__ == "__main__":
    print(weather_rain_summ())
    pass